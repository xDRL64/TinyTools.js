<script src="SCCM.js"></script>

<body>
	
</body>

<script> (()=>{

	
	let id = 0;
	const forceDisable = ()=>false;
	const check = forceDisable;

	const SCCM = SuperCustomContextMenu;
	const api_key = Symbol('dev user key for sccm api');

	// osx theme
	//

	const theme = SCCM.providing.theme;

	// osx context menu theme
	theme.macosx.set_defaultMain(api_key);
	theme.macosx.set_default(api_key);

	const osxDefMain = theme.macosx.get_defaultMain();
	const osxDef = theme.macosx.get_default();

	// osx horizontal menu theme
	
	theme.macosx.set_horizontal(api_key);
	theme.macosx.set_horizontal2nd(api_key);
	theme.macosx.set_horizontalMain(api_key);
	
	const osxHrzMain = theme.macosx.get_horizontalMain();
	const osxHrzMain_inits = osxHrzMain.initELEM;
	const osxHrzMainBehavior = osxHrzMain.behavior;
	const {menu:osxHrzMainMenu, item:osxHrzMainItem, layer:osxHrzMainLayer} = osxHrzMain_inits;
	const appleLogo = '<img width=20 height=20 src="https://icons.iconarchive.com/icons/pictogrammers/material/256/apple-icon.png"/>';

	const mainItem = osxHrzMainItem;
	const mainBehavior = osxHrzMainBehavior;

	//const {css, initELEM, behavior} = theme.empty.get_minimal();

	let sccmTemplate = {
		// root :
		settings : /* {} || */ theme.macosx.get_horizontal(),
		mainMenu : {
			// menu A :
			settings : {id:'main', init:osxHrzMainMenu, behavior:mainBehavior, layerInit:osxHrzMainLayer},
			items : [
				// settings{id, txt, check, update, init, behavior}
				{ settings:{id,txt:appleLogo, init:mainItem}, content:(data,e)=>console.log(data,e), },
				{ settings:{id,txt:'<b>Finder</b>', init:mainItem}, content:()=>{}, },
				{ settings:{id,txt:'Edition', init:mainItem}, content:()=>{}, },
				{ settings:{id,txt:'Affichage', init:mainItem}, content:()=>{}, },
				{ settings:{id,txt:'itemA4', init:mainItem}, content:()=>{}, },
				{ settings:{id,txt:'itemA5', init:mainItem}, content:()=>{}, },
				{ settings:{id:'A3',txt:'submenu', init:mainItem}, content:{
					// menu B :
					settings : {id:'B', init:theme.macosx.get_horizontal2nd().initELEM.menu},
					items : [
						{ settings:{id,txt:'itemB1'}, content:()=>{}, },
						{ settings:{id,txt:'itemB2',check}, content:()=>{}, },
						{ settings:{id,txt:'itemB3',}, content:{
							// menu C :
							settings : {id:'C',},
							items : [
								{ settings:{id,txt:'itemC1'}, content:{settings:{},items:[{ settings:{id,txt:'itemD1'}, content:()=>{}, },]}, },
								{ settings:{id,txt:'itemC2'}, content:()=>{}, },
								{ settings:{id,txt:'itemC3'}, content:()=>{}, },
							],
						  }, 
						},
					],
				  },
				},
			],
		},
	};

	const separator = {
		 settings:{init:e=>e.classList.add('asSeparator'), check:()=>false}, content:()=>{}, 
	};

	const osxCtxMenuTemplate = {
		settings : osxDef,
		mainMenu : {
			settings:{id:'main', init:osxDefMain.initELEM.menu},
			items : [
				{ settings:{id,txt:'New Folder'}, content:()=>{}, },
				separator,
				{ settings:{id,txt:'Read Information'}, content:()=>{}, },
				separator,
				{ settings:{id,txt:'Change wallpaper'}, content:()=>{}, },
				{ settings:{id,txt:'Align'}, content:()=>{}, },
				{ settings:{id,txt:'Align by'}, content:()=>{}, },
				{ settings:{id,txt:'Sort by'}, content:()=>{}, },
				{ settings:{id,txt:'Display presention options'}, content:()=>{}, },
			],
		},
	};
	
	// document.body settings
	const bodyTestBG = 'url("https://i.pinimg.com/736x/cb/c0/37/cbc0370bc576eef14f1d6bca0585221c.jpg")';
	const bs = document.body.style;
	bs.backgroundImage = bodyTestBG;
	document.body.onclick = ()=>(bs.backgroundImage = (bs.backgroundImage ? '' : bodyTestBG));

	// osx horizontal menu building
	(()=>{
		let handle = SuperCustomContextMenu.create_menu(sccmTemplate, api_key);
		handle.style.position = 'absolute';

		handle[api_key].set_parent(document.body);
		document.body.style.margin = 0;
		//document.body[api_key].update_rect();
	
		let data = {};
		handle[api_key].set_contextData(data);
	
		let menu = handle[api_key].get_menu('main');
		[...menu.children].forEach(child=>child[api_key].set_rectWithBorder(true));
		
		handle.style.position = 'fixed';
		handle.style.width = '100%';
		//handle[api_key].get_root().style.width = '100%';
		//menu[api_key].elems.get_layer().style.width = '100%';
		//menu.style.width = '100%';
	
		handle[api_key].open();
	})();

	// osx context menu building
	(()=>{
		let handle = SuperCustomContextMenu.create_menu(osxCtxMenuTemplate, api_key);
		handle.style.position = 'absolute';
	
		handle[api_key].set_parent(document.body);
		document.body.style.margin = 0;
		//document.body[api_key].update_rect();
	
		let menu = handle[api_key].get_menu('main');
		[...menu.children].forEach(child=>child[api_key].set_rectWithBorder(true));

		let data = {};
		document.body.oncontextmenu = e=>{
			e.preventDefault();
			handle[api_key].set_contextData(data);
			
			handle.style.left = e.clientX + window.scrollX + 'px';
			handle.style.top = e.clientY + window.scrollY + 'px';
			handle[api_key].get_root()[api_key].update_rect();
			menu[api_key].update_rect();

			handle[api_key].open();
		};
	
	})();



})(); </script>